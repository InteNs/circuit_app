#!/usr/bin/env ruby
require 'irb'
require 'irb/completion'
require File.expand_path('../../config/application.rb', __FILE__)

def application_context
  @application_context ||= Context.new(StateDefault.new)
end

def start
  application_context.print()
end

def import_circuit(name, file)
  file_parser = FileParser.new(file)
  circuit = build(file_parser.parse)
  application_context.state.go_next(application_context)
  application_context.print()
  print_circuit(circuit)
end



def build(parsed_circuit)
  circuit = build_circuit(parsed_circuit[0],parsed_circuit[1])
end

def build_circuit(parsed_components, parsed_connections)
  builder = CircuitBuilder.new(
    ComponentFactory.instance,
    CircuitFactory.instance
  )

  builder.build do |builder|
    parsed_components.each { |key, value|
      builder.add_component(key,value)
    }
    parsed_connections.each {|key, value|
      builder.add_connection(key,value)
      }

  end
end

def print_circuit(circuit)
  tp = TreePrinter.new
  tp.is_branch    = proc { |node| node.children.any? }
  tp.get_children = proc { |node| node.children }
  tp.format_node  = proc { |node| node.to_s }
  puts tp.format(circuit)
end
start
IRB.start
